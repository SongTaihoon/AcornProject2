<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mainPage.mapper.ReplyMapper">
	<select id="selectBoardNoPage" resultType="Reply">
		SELECT reply_no, 
			   title,
			   contents, 
			   post_time, 
			   img_path, 
			   board_no,
			   reply_no	as no,
			   userid as 'users.userid',
			   (SELECT COUNT(*) FROM REPLY_PREFER WHERE reply_no = no AND prefer = true) as good,
			   (SELECT COUNT(*) FROM REPLY_PREFER WHERE reply_no = no AND prefer = false) as bad
			   <if test="loginUsersId != null">
			   ,(SELECT prefer FROM REPLY_PREFER WHERE reply_no = no AND userid = #{loginUsersId}) as prefer_active
			   </if>	
			   FROM REPLY 
			   WHERE board_no = #{boardNo}
			   ORDER BY reply_no DESC
			   LIMIT #{startRow}, #{pageSize}
	</select>
	<select id="selectBoardNoCount" resultType="int">
		SELECT COUNT(*) FROM REPLY WHERE board_no = #{boardNo}
	</select>
	<select id="selectBoardNo" resultType="Reply" parameterType="int">
		SELECT *, userid 'users.userid' FROM REPLY 
		WHERE board_no = #{boardNo}
	</select>
	<select id="selectOne" resultType="Reply" parameterType="int">
		SELECT *, userid 'users.userid' FROM REPLY WHERE reply_no = #{reply_no}
	</select>
	<select id="selectUserId" resultType="Reply" parameterType="String">
		SELECT *, userid 'users.userid' FROM REPLY WHERE userid = #{userid}
	</select>
	<insert id="insertOne" parameterType="Reply">
		INSERT INTO REPLY (title, img_path, contents, board_no, userid) 
		VALUES (#{title}, #{img_path}, #{contents}, #{board_no}, #{users.userid})
	</insert>
	<update id="updateOne" parameterType="Reply">
		UPDATE REPLY SET title = #{title}, img_path = #{img_path}, contents = #{contents} 
		WHERE reply_no = #{reply_no}
	</update>
	<delete id="deleteOne" parameterType="int">
		DELETE FROM REPLY WHERE reply_no = #{reply_no}
	</delete>
</mapper>