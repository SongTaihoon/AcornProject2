<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:if="${(session.loginUser?.user_id == null) || ((session.loginUser?.user_id != reply.user?.user_id) && (session.loginUser?.adminCk == 0))}">
<!--///////////////////////////////////// 로그인 안 된 유저 or 다른 유저가 보는 리플 ///////////////////////////////////////////////////////////////// -->	
		<table class="mt-2 mb-3 table align-middle table-bordered">
			<tbody>
				<tr>
					<th class="table-light">글 번호</th>
					<td>
						<th:block th:text="${reply.reply_no}"></th:block>
					</td>
				</tr>
				<tr>
					<th class="table-light">작성자</th>
					<td>
						<th:block th:text="${reply.user?.user_id}"></th:block>
					</td>
				</tr>
				<tr>
					<th class="table-light">제목</th>
					<td>
						<th:block th:text="${reply.title}"></th:block>
					</td>
				</tr>
				<tr th:if="${reply.img_path != null}">
					<th class="table-light">사진</th>
					<td>
						<div th:if="${reply.img_path != null}">
							<!-- Button trigger modal -->
							<button type="button" class="btn border-0" data-bs-toggle="modal"
								style="padding: 0" 
								th:data-bs-target="'#replyImgModal' + ${reply.reply_no}">
								<img alt="댓글 이미지" class="img-thumbnail" style="height:100%; width:40%; object-fit: cover;"
				      	 	   		 th:src="@{/img/{file}(file=${reply.img_path})}">
							</button>			
							<!-- Modal -->
							<div class="modal fade"
								th:id="'replyImgModal' + ${reply.reply_no}" >
							  <div class="modal-dialog modal-dialog-centered modal-lg">
							    <div class="modal-content" 
							    style="background-color: rgba(255,255,255,0)">
							      <div class="modal-body">
			   						<img alt="댓글 이미지" class="img-thumbnail"
										 th:src="@{/img/{file}(file=${reply.img_path})}" width="760">  
							      </div>
							    </div>
							  </div>
							</div>							
						</div>
					</td>
				</tr>
				<tr>
					<th class="table-light">내용</th>
					<td>
						<th:block th:text="${reply.contents}"></th:block>	
					</td>	
				</tr>
				<tr>
					<th class="table-light">등록일</th>
					<td>
						<span th:text="${#dates.format(reply.post_time,'yyyy-MM-dd HH:mm:ss')}"></span>
					</td>	
				</tr>
			</tbody>
		</table>
		<div class="d-flex mb-2">
			<th:block th:if="${session.loginUser?.user_id != null}">
			    <a th:classappend="${
			    		(reply.prefer_active !=null && reply.prefer_active)
		  						?'bi-hand-thumbs-up-fill' 
		  						: 'bi-hand-thumbs-up'
			    					}" 
			    	class="btn btn-sm btn-outline-primary rounded-pill bi border-0" 
			    	th:text="${reply.good}"
			    	th:href="|javascript:replyPreferHandler(${reply.reply_no}, ${reply.prefer_active}, 'good')|">
			    </a>
		 		<a th:classappend="${
			    		(reply.prefer_active != null && !reply.prefer_active)
		  						?'bi-hand-thumbs-down-fill' 
		  						: 'bi-hand-thumbs-down'
			    					}"
			    	class="btn btn-sm btn-outline-danger rounded-pill bi border-0" 
			    	th:text="${reply.bad}" 
			    	th:href="|javascript:replyPreferHandler(${reply.reply_no}, ${reply.prefer_active}, 'bad')|">
			    </a>
			</th:block>
			<th:block th:unless="${session.loginUser?.user_id != null}">
			    <a th:classappend="${
			    		(reply.prefer_active != null && reply.prefer_active)
		  						?'bi-hand-thumbs-up-fill' 
		  						: 'bi-hand-thumbs-up'
			    					}" 
			    	class="btn btn-sm btn-outline-primary rounded-pill bi border-0" 
			    	th:text="${reply.good}">
			    </a>
		 		<a th:classappend="${
			    		(reply.prefer_active != null && !reply.prefer_active)
		  						?'bi-hand-thumbs-down-fill' 
		  						: 'bi-hand-thumbs-down'
			    					}"
			    	class="btn btn-sm btn-outline-danger rounded-pill bi border-0" 
			    	th:text="${reply.bad}">
			    </a>
			</th:block>  	
		</div>	
    </th:block>
  	<th:block th:unless="${(session.loginUser?.user_id == null) || ((session.loginUser?.user_id != reply.user?.user_id) && (session.loginUser?.adminCk == 0))}">
<!--///////////////////////////////////// 관리자가 보는 다른 회원의 리플 ///////////////////////////////////////////////////////////////// -->				
  		<form action="/reply/update.do" method="post" enctype="multipart/form-data" style="width: 100%" name="replyUpdateForm">
	  		<table class="mb-3 mt-2 table align-middle table-bordered">
				<tbody>
					<tr>
						<th class="table-light">글 번호</th>
						<td style="background-color: white;">
							<input name="reply_no" th:value="${reply.reply_no}" 
								   type="text" class="form-control" readonly>
						</td>
					</tr>
					<tr>
						<th class="table-light">작성자</th>
						<td style="background-color: white;">
							<input name="user.user_id" th:value="${reply.user?.user_id}" 
								   type="text" class="form-control" readonly>
						</td>
					</tr>
					<tr>
						<th class="table-light">제목</th>
						<td style="background-color: white;">
							<input name="title" type="text" class="form-control" th:value="${reply.title}" 
								   onkeyup="noSpace(this);" onchange="noSpace(this);">
						</td>
					</tr>
					<tr>
						<th class="table-light">사진</th>
						<td style="background-color: white;">
							<div class="mb-2" th:if="${reply.img_path != null}">
								<p class="mb-2"> 삭제하기
									<input name="remove_img_check" type="checkbox"
								   		   class="form-check-input ms-1" value="1">
								</p>
								<!-- Button trigger modal -->
								<button type="button" class="btn border-0" data-bs-toggle="modal"
									style="padding: 0" 
									th:data-bs-target="'#replyImgModal' + ${reply.reply_no}">
									<img alt="댓글 이미지" class="img-thumbnail" 
									 style="height:100%; width:40%; object-fit: cover;"
									th:src="@{/img/{file}(file=${reply.img_path})}">
								</button>	
								<!-- Modal -->
								<div class="modal fade"
									th:id="'replyImgModal' + ${reply.reply_no}" >
								  <div class="modal-dialog modal-dialog-centered modal-lg">
								    <div class="modal-content" 
								    style="background-color: rgba(255,255,255,0)">
								      <div class="modal-body">
				   						<img alt="댓글 이미지" class="img-thumbnail"
											 th:src="@{/img/{file}(file=${reply.img_path})}" width="760">  
								      </div>
								    </div>
								  </div>
								</div>							
							</div>
							<input name="imgFile" type="file" class="form-control form-control-lg">
						</td>
					</tr>
					<tr>
						<th class="table-light">내용</th>
						<td style="background-color: white;">
							<textarea name="contents" class="form-control" th:text="${reply.contents}" 
									  onkeyup="noSpace(this);" onchange="noSpace(this);"></textarea>
						</td>	
					</tr>
					<tr>
						<th class="table-light">등록일</th>
						<td style="background-color: white;">
							<input name="post_time" type="text" class="form-control" th:value="${#dates.format(reply.post_time,'yyyy-MM-dd HH:mm:ss')}" readonly>
						</td>	
					</tr>
				</tbody>
			</table>
  			<div class="d-flex mb-2 align-items-center">
			    <a th:classappend="${
			    		(reply.prefer_active != null && reply.prefer_active)
		  						?'bi-hand-thumbs-up-fill' 
		  						: 'bi-hand-thumbs-up'
			    					}"
			    	class="btn btn-sm btn-outline-primary rounded-pill bi border-0" 
			    	th:text="${reply.good}"
			    	th:href="|javascript:replyPreferHandler(${reply.reply_no}, ${reply.prefer_active}, 'good')|">
			    </a>
		 		<a th:classappend="${
			    		(reply.prefer_active != null && !reply.prefer_active)
		  						?'bi-hand-thumbs-down-fill' 
		  						: 'bi-hand-thumbs-down'
			    					}"
			    	class="btn btn-sm btn-outline-danger rounded-pill bi border-0" 
			    	th:text="${reply.bad}" 
			    	th:href="|javascript:replyPreferHandler(${reply.reply_no}, ${reply.prefer_active}, 'bad')|">
			    </a>					
  				<div class="ms-auto">
					<button type="reset" class="btn btn-lg btn-outline-warning">초기화</button>
					<button type="submit" class="btn btn-lg btn-outline-success" style="margin-left: 8px; margin-right: 8px;">수정</button>
					<!-- Button trigger modal -->
					<button type="button" class="btn btn-outline-danger btn-lg" 
						    style="margin-right: 8px;" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
					  삭제
					</button>
					<!-- Modal -->
					<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
					  <div class="modal-dialog">
					    <div class="modal-content">
					      <div class="modal-header border-0">
					        <h1 class="modal-title fs-5" id="staticBackdropLabel">경고</h1>
					        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					      </div>
					      <div class="modal-body">
					        한 번 삭제하면 복구할 수 없습니다. 정말 삭제하시겠습니까?
					      </div>
					      <div class="modal-footer border-0">
					        <button type="button" class="btn btn-outline-dark btn-lg" data-bs-dismiss="modal" style="margin-right: 8px;">취소</button>
							<a th:href="@{/reply/delete/{reply_no}(reply_no=${reply.reply_no})}"
								class="btn btn-lg btn-outline-danger">삭제</a>
					      </div>
					    </div>
					  </div>
					</div>
					<input type="hidden" name="board_no" th:value="${reply.board_no}">
					<input type="hidden" name="img_path" th:value="${reply.img_path}">
				</div>
			</div>
  		</form>
  	</th:block>
</html>