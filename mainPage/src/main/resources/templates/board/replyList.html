<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<script src="/public/js/board/replyList.js" defer="defer"></script>
	<div th:if="${(session.loginUser?.user_id != null)}" class="list-group-item bg-light">
	<div class="d-flex align-items-center">
		<p style="font-size: 30px; margin-top: 8px;">내가 작성한 댓글</p>
		<p class="ms-auto mb-0">
		  <button class="btn btn-lg btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#replyUpdateCollapse" 
		  		  aria-expanded="false" aria-controls="collapseExample">
		    토글
		  </button>
		</p>
	</div>
	<div class="collapse collapse show" id="replyUpdateCollapse">
		<ul class="list-group">	
			<th:block th:each="reply : ${replys}">
				<th:block th:if="${(session.loginUser?.user_id == reply.user?.user_id)}">
			  		<li th:id="${'replyLi' + reply.reply_no}"
			  			class="list-group-item">	
			  		  <form action="/reply/update.do" method="post" enctype="multipart/form-data" style="width: 100%" name="replyUpdate">
				  		<table class="mb-3 table align-middle table-bordered">
							<tbody>
								<tr>
									<th class="table-light">글 번호</th>
									<td>
										<input name="reply_no" th:value="${reply.reply_no}" 
											   type="text" class="form-control" readonly>
									</td>
								</tr>
								<tr>
									<th class="table-light">작성자</th>
									<td>
										<input name="user.user_id" th:value="${reply.user?.user_id}" 
											   type="text" class="form-control" readonly>
									</td>
								</tr>
								<tr>
									<th class="table-light">제목</th>
									<td>
										<input name="title" type="text" class="form-control" th:value="${reply.title}" 
											   onkeyup="noSpace(this);" onchange="noSpace(this);">
									</td>
								</tr>
								<tr>
									<th class="table-light">사진</th>
									<td>
										<div class="mt-2 mb-3" th:if="${reply.img_path != null && reply.img_path != ''}">
											<p> 삭제하기
												<input name="remove_img_check" type="checkbox"
											   		   class="form-check-input ms-1" value="1">
											</p>
											<!-- Button trigger modal -->
											<button type="button" class="btn border-0" data-bs-toggle="modal"
												style="padding: 0" 
												th:data-bs-target="'#replyImgModal' + ${reply.reply_no}">
												<img alt="댓글 이미지" class="img-thumbnail" 
												 style="height:100%; width:40%; object-fit: cover;"
												th:src="@{/img/{file}(file=${reply.img_path})}">
											</button>	
											<!-- Modal -->
											<div class="modal fade"
												th:id="'replyImgModal' + ${reply.reply_no}" >
											  <div class="modal-dialog modal-dialog-centered modal-lg">
											    <div class="modal-content" 
											    style="background-color: rgba(255,255,255,0)">
											      <!-- 
											      <div class="modal-header" style="border: none">
											        <button type="button" 
											        class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
											      </div>
											       -->
											      <div class="modal-body">
							   						<img alt="댓글 이미지" class="img-thumbnail"
														 th:src="@{/img/{file}(file=${reply.img_path})}" width="760">  
											      </div>
											    </div>
											  </div>
											</div>							
										</div>
										<input name="imgFile" type="file" class="form-control form-control-lg">
									</td>
								</tr>
								<tr>
									<th class="table-light">내용</th>
									<td>
										<textarea name="contents" class="form-control" th:text="${reply.contents}" 
												  onkeyup="noSpace(this);" onchange="noSpace(this);"></textarea>
									</td>	
								</tr>
								<tr>
									<th class="table-light">등록일</th>
									<td>
										<input name="post_time" type="text" class="form-control" th:value="${#dates.format(reply.post_time,'yyyy-MM-dd HH:mm:ss')}" readonly>
									</td>	
								</tr>
							</tbody>
						</table>
			  			<div class="d-flex mb-2 align-items-center">
							<th:block th:if="${session.loginUser?.user_id != reply.user?.user_id}">
							    <a th:classappend="${
							    		(reply.prefer_active != null && reply.prefer_active)
						  						?'bi-hand-thumbs-up-fill' 
						  						: 'bi-hand-thumbs-up'
							    					}"
							    	class="btn btn-sm btn-outline-primary rounded-pill bi border-0" 
							    	th:text="${reply.good}"
							    	th:href="|javascript:replyPreferHandler(${reply.reply_no}, ${reply.prefer_active}, 'good')|">
							    </a>
						 		<a th:classappend="${
							    		(reply.prefer_active != null && !reply.prefer_active)
						  						?'bi-hand-thumbs-down-fill' 
						  						: 'bi-hand-thumbs-down'
							    					}"
							    	class="btn btn-sm btn-outline-danger rounded-pill bi border-0" 
							    	th:text="${reply.bad}" 
							    	th:href="|javascript:replyPreferHandler(${reply.reply_no}, ${reply.prefer_active}, 'bad')|">
							    </a>
							</th:block>	
							<th:block th:unless="${session.loginUser?.user_id != reply.user?.user_id}">
							    <a th:classappend="${
							    		(reply.prefer_active != null && reply.prefer_active)
						  						?'bi-hand-thumbs-up-fill' 
						  						: 'bi-hand-thumbs-up'
							    					}"
							    	class="btn btn-sm btn-outline-primary rounded-pill bi border-0" 
							    	th:text="${reply.good}">
							    </a>
						 		<a th:classappend="${
							    		(reply.prefer_active != null && !reply.prefer_active)
						  						?'bi-hand-thumbs-down-fill' 
						  						: 'bi-hand-thumbs-down'
							    					}"
							    	class="btn btn-sm btn-outline-danger rounded-pill bi border-0" 
							    	th:text="${reply.bad}">
							    </a>
							</th:block>						
			  				<div class="ms-auto">
								<button type="reset" class="btn btn-lg btn-outline-warning">초기화</button>
								<button type="submit" class="btn btn-lg btn-outline-success" style="margin-left: 8px; margin-right: 8px;">수정</button>
								<a th:href="@{/reply/delete/{reply_no}(reply_no=${reply.reply_no})}"
									class="btn btn-lg btn-outline-danger">삭제</a>
								<input type="hidden" name="board_no" th:value="${reply.board_no}">
								<input type="hidden" name="img_path" th:value="${reply.img_path}">
							</div>
						</div>
		  			</form>
				</li>
			</th:block>
		  </th:block>		  
		</ul>	
	</div>
	</div>
	<th:block th:each="reply : ${replys}">
		<th:block th:if="${(session.loginUser?.user_id == null) || (session.loginUser?.user_id != reply.user?.user_id)}">
	  		<li th:id="${'replyLi' + reply.reply_no}"
	  			class="list-group-item"
	  			th:insert="/board/replyDetail">	
			</li>
		</th:block>
	</th:block>
<!-- <div class="m-2 d-flex justify-content-center" th:insert="/pagination.html"></div> -->
<script>
//값이 없을 때 submit 불가
var replyUpdate = document.forms.replyUpdate;
var title = replyUpdate.title;
var contents = replyUpdate.contents;
document.forms.replyUpdate.addEventListener("submit", (event) => {
	if(!(title.value) || !(contents.value)) {
		event.preventDefault();		
	}
});
function noSpace(obj) { // 공백사용못하게
    var str = /\s/;  // 공백체크
    if(str.exec(obj.value.trim)) { //공백 체크
        //alert("해당 항목에는 첫 글자 공백을 사용할수 없습니다.");
        obj.focus();
        obj.value = obj.value.replace(/^ +/,''); // 공백제거
        return false;
    }
}
</script>
</html>